{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% block style %}
<link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.min.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'package/dist/sweetalert2.min.css' %}">
<link rel="stylesheet" href="{% static 'css/sweetalert2.min.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'fontawesome/css/all.css' %}">

<script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
<style>
    .payform {
        display: flex;
        flex-direction: column;
        margin-top: 20px;
    }
    .dataTables_filter {
        float: right;
    }
    .dataTables_filter input {
        margin-left: 0.5em;
        width: 200px;
        display: inline-block;
        margin-bottom: 10px;
    }
</style>
    <style>
        .sumcard{
            margin-top: 50px;
            margin-bottom: 20px;
            margin-left: 10%;
            margin-right: 10%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }
        .actcard1{
            border-radius: 10px;
            box-shadow: 0 0 3px gray;
            border-bottom: 8px solid darkgreen;
            width: 250px;
            height: 190px;
            background-color: aliceblue;
        }
        .actcard2{
            border-radius: 10px;
            box-shadow: 0 0 3px gray;
            border-bottom: 8px solid rgb(100, 0, 67);
            width: 250px;
            height: 190px;
            background-color: aliceblue;
        }
        .actcard3{
            border-radius: 10px;
            box-shadow: 0 0 3px gray;
            border-bottom: 8px solid rgb(158, 50, 0);
            width: 250px;
            height: 190px;
            background-color: aliceblue;
        }
        .actcard4{
            border-radius: 10px;
            box-shadow: 0 0 3px gray;
            border-bottom: 8px solid rgb(0, 150, 155);
            width: 250px;
            height: 190px;
            background-color: aliceblue;
        }
        .actcard5{
            border-radius: 10px;
            box-shadow: 0 0 3px gray;
            border-bottom: 8px solid rgb(81, 99, 2);
            width: 250px;
            height: 190px;
            background-color: aliceblue;
        }
        .actcard6{
            border-radius: 10px;
            box-shadow: 0 0 3px gray;
            border-bottom: 8px solid rgb(102, 29, 0);
            width: 250px;
            height: 190px;
            background-color: aliceblue;
        }
        .actcard7{
            border-radius: 10px;
            box-shadow: 0 0 3px gray;
            border-bottom: 8px solid rgb(252, 38, 48);
            width: 250px;
            height: 190px;
            background-color: aliceblue;
        }
    </style>
{% endblock %}

{% block content %}
{% if messages %}
    <div class="alert alert-info">
        {% for message in messages %}
            <div>{{ message }}</div>
        {% endfor %}
    </div>
{% endif %}

<div class="sumcard">
    <div class="actcard1">
        <center style="margin-top: 30px; margin-bottom: auto; color: rgb(27, 26, 26);">
            <h3><i class="fas fa-door-open"></i></h3>
            <h3>No. Of Rooms</h3>
            <h3>{{ number_of_rooms }}</h3>
        </center>
    </div>
    <div class="actcard2">
        <center style="margin-top: 30px; margin-bottom: auto; color: rgb(27, 26, 26);">
        <h3><i class="fas fa-bed"></i></h3>
            <h5>Available Rooms</h5>
            <h3>{{ available_rooms }}</h3>
        </center>
    </div>
    
    <div class="actcard7">
        <center style="margin-top: 30px; margin-bottom: auto; color: rgb(27, 26, 26);">
        <h3><i class="fas fa-calendar-check"></i></h3>
            <h5>Reserved Rooms</h5>
            <h3>{{ reserved_rooms }}</h3>
        </center>
    </div>
    <div class="actcard3">
        <center style="margin-top: 30px; margin-bottom: auto; color: rgb(27, 26, 26);">
        <h3> <i class="fas fa-users"></i> </h3>
            <h3>No. Of Clients</h3>
            <h3>{{ number_of_clients }}</h3>
        </center>
    </div>
    <div class="actcard4">
        <center style="margin-top: 30px; margin-bottom: auto; color: rgb(27, 26, 26);">
        <h3> <i class="fas fa-money-bill-wave"></i></h3> 
            <h3>Total Arrears</h3>
            <h3>{{ total_arrears | intcomma }}</h3>
        </center>
    </div>
    <div class="actcard5">
        <center style="margin-top: 30px; margin-bottom: auto; color: rgb(27, 26, 26);">
        <h3> <i class="fas fa-user-tie"></i></h3> 
            <h3>Adult on Board</h3>
            <h3>{{ total_adults }}</h3>
        </center>
    </div>
    <div class="actcard6">
        <center style="margin-top: 30px; margin-bottom: auto; color: rgb(27, 26, 26);">
        <h3> <i class="fas fa-baby"></i></i></h3> 
            <h5>Children on Board</5>
            <h3>{{ total_children }}</h3>
        </center>
    </div>
</div>


<center>
<a href="{% url 'Book_A_Client' %}" class="btn btn-primary py-md-3 px-md-5 me-3 animated slideInLeft">Book A Client</a>
<a href="{% url 'client-detail' %}" class="btn btn-secondary py-md-3 px-md-5 animated slideInRight">Check Client Out</a>
</center>
<br>
<hr>
{% if 'Administrator' in request.user.permissions or 'Account' in request.user.permissions %}
<div style="width: 100%; max-width: 800px; margin: auto;">
    <h4>Payments received analysis for the year</h4>
    <canvas id="paymentsChart"></canvas>
</div>
{% endif %}

<hr>
<div class="tainer">
    <div class="row">
        <div class="col-6">    
            <h2>Arrears</h2>
            {%  if arrears_clients %}
    <table class="table table-bordered" style="margin: 15px 5px;" id="arrearTable">
        <thead>
            <tr>
                <th scope="col" style=" font-weight: bolder; font-size: large;">#</th>
                <th scope="col" style=" font-weight: bolder; font-size: large;">Client</th>
                <th scope="col" style=" font-weight: bolder; font-size: large;">Room</th>
                <th scope="col" style=" font-weight: bolder; font-size: large;">Arrears</th>
                <th scope="col" style=" font-weight: bolder; font-size: large;">Action</th>
            </tr>
        </thead>
        <tbody>
            {% for x in arrears_clients %}
            <tr>
                <th scope="row">{{x.id}}</th>
                <td>{{x.booked.client.get_full_name}}</td>
                <td>{{x.booked.room}}</td>
                <td>{{x.arrears}}</td>
                <td><a class="btn btn-primary" href="{% url 'managepayment' %}">Receive Arrears</a></td>
            </tr>
            
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <h5>No Clients with arrears</h5>
    {% endif %}
    </div>

    <div class="col-6">    
        <h2>Clients Due for Checkout</h2>
        {% if clients_today %}
<table class="table table-bordered" style="margin: 15px 5px;" id="arrearTable2">
    <thead>
        <tr>
            <th scope="col" style=" font-weight: bolder; font-size: large;">#</th>
            <th scope="col" style=" font-weight: bolder; font-size: large;">Client</th>
            <th scope="col" style=" font-weight: bolder; font-size: large;">Room</th>
            <th scope="col" style=" font-weight: bolder; font-size: large;">Check Out Date</th>
            <th scope="col" style=" font-weight: bolder; font-size: large;">Action</th>
        </tr>
    </thead>
    <tbody>
        {% for x in clients_today %}
        <tr>
            <th scope="row">{{x.id}}</th>
            <td>{{x.client.get_full_name}}</td>
            <td>{{x.room}}</td>
            <td>{{x.Check_out}}</td>
            <td>
                <a class="btn btn-primary" href="{% url 'extend_booking' x.id %}">Add Days</a>
                <a class="btn btn-danger" href="{% url 'checkout' idd=x.client.id %}" onclick="return confirm('Are you sure you want to check out this client?');">Check Out</a>
            </td>
        </tr>
        
        {% endfor %}
    </tbody>
</table>
{% else %}
    <h5>No Clients due for check-out </h5>
    {% endif %}
</div>


    </div>
    <hr style="height:5px">
    <div class="row">
        <div class="col-8">    
            <h2>Reservations</h2>
            {% if reservation %}
    <table class="table table-bordered" style="margin: 15px 5px;" id="arrearTable3">
        <thead>
            <tr>
                <th scope="col" style=" font-weight: bolder; font-size: large;">#</th>
                <th scope="col" style=" font-weight: bolder; font-size: large;">Client</th>
                <th scope="col" style=" font-weight: bolder; font-size: large;">Mobile</th>
                <th scope="col" style=" font-weight: bolder; font-size: large;">Room Reserved</th>
                <th scope="col" style=" font-weight: bolder; font-size: large;">Check Out Date</th>
                <th scope="col" style=" font-weight: bolder; font-size: large;">Action</th>
            </tr>
        </thead>
        <tbody>
            {% for x in reservation %}
            <tr>
                <th scope="row">{{x.id}}</th>
                <td>{{x.client.get_full_name}}</td>
                <td>{{x.client.mobile}}</td>
                <td>{{x.room}}</td>
                <td>{{x.Check_out}}</td>
                <td>
                    <a class="btn btn-primary" href="{% url 'mark_client_in' x.id %}" onclick="return confirm('Are you sure this client has appeared?');">Client is In</a>
                    <a class="btn btn-danger" href="{% url 'cancel_reservation' x.id %}" onclick="return confirm('Are you sure you want to cancel this reservation?');">Cancel</a>
                </td>
            </tr>
            
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <h5>No Reservations today</h5>
    {% endif %}
    </div>
    </div>
</div>

{% endblock %}
{% block js %}
<script src="{% static 'js/jquery.js' %}"></script>
<script src="{% static 'js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'js/dataTables.buttons.min.js' %}"></script>
<script src="{% static 'js/buttons.html5.min.js' %}"></script>
<script src="{% static 'js/buttons.print.min.js' %}"></script>
<script src="{% static 'js/jszip.min.js' %}"></script>
<script src="{% static 'js/pdfmake.min.js' %}"></script>
<script src="{% static 'js/vfs_fonts.js' %}"></script>
<script src="{% static 'js/decimal.min.js' %}"></script>

<script>

    $(document).ready(function() {
        const ctx = document.getElementById('paymentsChart').getContext('2d');
        const paymentsChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: {{ months|safe }},
                datasets: [{
                    label: 'Payments',
                    data: {{ monthly_amounts|safe }},
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',  // Blue color
                    borderColor: 'rgba(54, 162, 235, 1)',        // Blue color
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    });
</script>


    <script>
function initializeDataTable(tableId) {
    $(tableId).DataTable({
        dom: 'Bfrtip',
        buttons: [
            {
                extend: 'copy',
                text: 'Copy',
                className: 'btn btn-secondary'
            },
            {
                extend: 'csv',
                text: 'CSV',
                className: 'btn btn-secondary'
            },
            {
                extend: 'excel',
                text: 'Excel',
                className: 'btn btn-secondary'
            },
            {
                extend: 'pdf',
                text: 'PDF',
                className: 'btn btn-secondary'
            },
            {
                extend: 'print',
                text: 'Print',
                className: 'btn btn-secondary'
            }
        ]
    });
}

$(document).ready(function() {
    initializeDataTable('#arrearTable');
    initializeDataTable('#arrearTable2');
    initializeDataTable('#arrearTable3');
});
</script>
    {% endblock %}